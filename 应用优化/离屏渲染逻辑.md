图层的叠加绘制大致遵循“画家算法”，也就是由远到近的方式将图层绘制到屏幕上，绘制近距离图层会有覆盖远图层的逻辑。

![[488D14DC-7DE6-4F35-95A0-03330DB59699.png]]

普通渲染方式，绘制完一层图层后，直接舍弃掉。紧接着绘制稍近的图层。以此类推：

![[2CD86A6B-0FEB-4404-82F0-61C6FA214250.png]]

而我们进行离屏渲染方式（圆角、剪裁等操作）时，每层图层绘制完不会马上删除，而是先保存在离屏缓存区中，等图层绘制完成后，再依次进行特殊处理（圆角、剪裁等操作）。  

![[52EC43FC-793D-4525-8A11-47E39E7EE206.png]]

注意：通常会触发离屏渲染，除了圆角、剪裁外，还有设置了透明度+组透明（layer.allowsGroupOpacity+layer.opacity），阴影属性（shadowOffset 等）都会产生类似的效果，因为组透明度、阴影都是和裁剪类似的，会作用与 layer 以及其所有 sublayer 上，这就导致必然会引起离屏渲染。
