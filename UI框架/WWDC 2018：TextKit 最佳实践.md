#textkit #uikit 

> WWDC 2018 Session 221: [TextKit Best Practices](https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Fvideos%2Fplay%2Fwwdc2018%2F221%2F)

> ä½œè€…ç®€ä»‹ï¼š [@halohily](https://link.juejin.im?target=https%3A%2F%2Fweibo.com%2Fhalohily) ï¼Œç½‘æ˜“æœ‰é“ iOS å¼€å‘å·¥ç¨‹å¸ˆã€‚æ˜é‡‘ä¸»é¡µï¼š [halohily](https://juejin.im/user/5923121f8d6d810058ecdb21)

## å¼•è¨€

æ–‡æœ¬å†…å®¹åœ¨ app å†…éšå¤„å¯è§ï¼Œå±•ç¤ºæ–‡æœ¬çš„æ–¹å¼ä¹Ÿæ˜¯å¤šç§å¤šæ ·ã€‚å…³æ³¨è¿‡æ€§èƒ½æå‡çš„åŒå­¦ä¼šå‘ç°ï¼Œæ–‡æœ¬æ§ä»¶çš„é«˜æ•ˆä½¿ç”¨å¯¹äºæ•´ä¸ªé¡µé¢æ€§èƒ½çš„æå‡è‡³å…³é‡è¦ã€‚ä¸ºæ­¤ï¼Œè‹¹æœå’Œå¼€å‘è€…éƒ½åœ¨ä¸æ–­åŠªåŠ›ã€‚æ¯”å¦‚è‹¹æœæ—¥æ¸å®Œå–„çš„æ–‡æœ¬æ¡†æ¶ï¼Œä»¥åŠç¬¬ä¸‰æ–¹æ–‡æœ¬æ¡†æ¶çš„ä»£è¡¨ [YYText](https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fibireme%2FYYText) ã€‚

è¿™ä¸ª session æ—¨åœ¨æŒ‡å¯¼å¼€å‘è€…å¦‚ä½•æ­£ç¡®åœ°ä½¿ç”¨ `TextKit` è¿›è¡Œæ–‡æœ¬å†…å®¹çš„å±•ç¤ºï¼Œå¾ªåºæ¸è¿›åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š

* æ ¸å¿ƒç†è®º
* ç”¨ä»¥æ¼”ç¤ºç†è®ºçš„å°ä¾‹å­
* ç»¼åˆè¿ç”¨çš„ä¼˜ç§€å®æˆ˜æ¡ˆä¾‹
## ä¸€ã€æ ¸å¿ƒç†è®º

### 1.1 ä»€ä¹ˆæ˜¯ TextKit ï¼Ÿ

å’Œå¹³æ—¶ä½¿ç”¨çš„æ¡†æ¶æœ‰äº›ä¸åŒï¼Œæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨ `import` å…³é”®å­—æ¥å¯¼å…¥ `TextKit` ã€‚åŒ…å« `UILabel`ã€`UITextField` ç­‰æ§ä»¶çš„ `UIKit` æ¡†æ¶ï¼ˆç”¨äº iOSï¼‰ï¼Œä»¥åŠåŒ…å« `NSTextView` ç­‰æ§ä»¶çš„ `AppKit` æ¡†æ¶ï¼ˆç”¨äº Mac OSï¼‰ï¼Œéƒ½æ˜¯åŸºäº `TextKit` æ„å»ºã€‚åœ¨ä½¿ç”¨ä¸Šé¢çš„æ–‡æœ¬æ§ä»¶æ—¶ï¼Œå…¶å®å°±æ˜¯åœ¨ä½¿ç”¨ `TextKit` ï¼Œå®ƒååŒ `Core Text`ã€`Core Graphics` ä»¥åŠ `Foundation` ï¼Œä¸€èµ·ä¸ºæˆ‘ä»¬çš„ app æä¾›å¼ºå¤§çš„æ–‡æœ¬å±•ç¤ºèƒ½åŠ›ã€‚

![[1641167925b12ad2.jpeg]]

åˆ©ç”¨ `TextKit` çš„èƒ½åŠ›ï¼Œä½ å¯ä»¥éå¸¸å®¹æ˜“åœ°å±•ç¤ºä¸‹é¢é£æ ¼å„å¼‚çš„æ–‡æœ¬ã€‚

![[164116812b2ac3a4.jpeg]]

### 1.2 é€‰æ‹©æ­£ç¡®çš„æ§ä»¶

å¯¹äºä¸åŒç±»å‹çš„æ–‡æœ¬ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©åˆé€‚çš„æ–‡æœ¬æ§ä»¶ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•å†³å®šå‘¢ï¼Ÿè‹¹æœä¸ºæˆ‘ä»¬æä¾›äº†æ¯”è¾ƒæ˜ç¡®çš„æŒ‡å¯¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚åœ¨ä½¿ç”¨ `UIKit` å’Œ `AppKit` æ—¶ï¼Œæƒ…å½¢ä¼šç¨æœ‰ä¸åŒï¼Œæ‰€ä»¥åˆ†å¼€è¿›è¡Œæè¿°ã€‚

* `UIKit` çš„é€‰æ‹©è·¯å¾„ï¼š

![[1641168f9e39cdbd.jpeg]]

* `AppKit` çš„é€‰æ‹©è·¯å¾„ï¼š

![[1641169724e97e73.jpeg]]

å›¾ä¸­çš„æè¿°éå¸¸æ¸…æ™°æ˜“è¯»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ `UILabel` ç”¨æ¥å±•ç¤ºè¾ƒå°‘çš„æ–‡æœ¬å†…å®¹æˆ–è€…è¾ƒå°‘çš„è¡Œæ•°ï¼Œç„¶è€Œï¼Œåœ¨ `AppKit` æ¡†æ¶ä¸‹æ˜¯æ²¡æœ‰ `Label` æ§ä»¶çš„ï¼Œè¿™æ—¶å¯ä»¥é€‰æ‹© `NSTextField` æ§ä»¶ï¼Œé€šè¿‡ç¦ç”¨æ–‡æœ¬ç¼–è¾‘å±æ€§ï¼Œæ¥è·å¾—å’Œ `UILabel` ä¸€æ ·çš„ç‰¹æ€§ã€‚

#### 1.2.1 æ–‡æœ¬ç»˜åˆ¶ï¼ˆstring drawingï¼‰çš„æ­£ç¡®ä½¿ç”¨

æœ‰çš„æ—¶å€™ï¼Œå¤§å®¶å¯èƒ½ä¸ºäº†è·å¾—æ›´ä¼˜çš„æ€§èƒ½ï¼ˆé¿å…ç”Ÿæˆè¿‡å¤šçš„è§†å›¾å¯¹è±¡å®ä¾‹ï¼‰ï¼Œé€šè¿‡è°ƒç”¨å¦‚ä¸‹æ–¹æ³•æ¥ä½¿ç”¨æ–‡æœ¬ç»˜åˆ¶ï¼š

```swift
func draw(at: CGPoint)

func draw(in: CGRect)

func draw(with: CGRect,
options: NSStringDrawingOptions = [],
context: NSStringDrawingContext?)
```

ç„¶è€Œï¼Œè‹¹æœå¹¶ä¸æ¨èç»å¸¸è¿™æ ·ä½¿ç”¨ã€‚å¦‚æœä½ ä¾ç„¶éœ€è¦ä½¿ç”¨çš„è¯ï¼Œè‹¹æœä¹Ÿè´´å¿ƒåœ°ç»™å‡ºäº†ä¸€äº›å»ºè®®ï¼š

* å°½é‡ç”¨äºæ•°é‡è¾ƒå°‘çš„æ–‡æœ¬
* é™åˆ¶è°ƒç”¨ `draw` æ–¹æ³•çš„é¢‘ç‡ï¼ˆå°½é‡å‡å°‘è°ƒç”¨æ¬¡æ•°ï¼‰
* é™åˆ¶å®šåˆ¶åŒ–å±æ€§çš„æ•°é‡ï¼ˆå°½é‡å‡å°‘å®šåˆ¶åŒ–å±æ€§ï¼‰
ä¸ºä»€ä¹ˆè¿™ç§ä½¿ç”¨æ–¹å¼ä¸è¢«æ¨èå‘¢ï¼Ÿé¦–å…ˆæ˜¯å› ä¸º `UILabel`ã€`UITextView` ç­‰æ§ä»¶æä¾›äº†è‰¯å¥½çš„ç¼“å­˜æœºåˆ¶ï¼Œæ‰€ä»¥åœ¨åˆé€‚çš„æ—¶å€™é€‰æ‹©è¿™äº›æ§ä»¶ï¼Œåè€Œå¯ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ï¼ˆç›¸è¾ƒ string drawing è€Œè¨€ï¼‰ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨è‡ªåŠ¨å¸ƒå±€çš„æ—¶å€™ã€‚

ç»˜åˆ¶ `attributed string` æ—¶ï¼Œå¦‚æœè¿‡å¤šåœ°è°ƒç”¨ `draw` æ–¹æ³•ï¼Œä¼šæ˜æ˜¾åœ°é™ä½æ€§èƒ½ã€‚å› ä¸ºç³»ç»Ÿåœ¨æ¯æ¬¡ç»˜åˆ¶ä¹‹å‰éœ€è¦é‡Šæ”¾ä¹‹å‰æ‰€æœ‰çš„ `attribute` å¯¹è±¡ã€‚å› æ­¤ï¼Œå¯¹äºé¢å¤–çš„ `attribute` ï¼Œè¯·å°½é‡åœ¨ç¡®å®šå®ƒä»¬çš„è§†è§‰æ•ˆæœï¼ˆä¾‹å¦‚å­—ä½“ã€é¢œè‰²ï¼‰æ—¶æ‰è¿›è¡Œç»˜åˆ¶ã€‚

**æœ€åï¼Œè‹¹æœè¿˜æ˜¯ä¸å¿˜å¼ºè°ƒï¼Œå¦‚æœä½¿ç”¨äº† string drawingï¼Œå°±ä¼šå¤±å»ä¸‹å›¾æ‰€ç¤ºçš„æ–‡æœ¬æ§ä»¶æä¾›çš„æ‰€æœ‰ç‰¹æ€§ã€‚å› æ­¤ï¼Œè¯·å°½å¯èƒ½åœ°ä½¿ç”¨æ–‡æœ¬æ§ä»¶ã€‚**

![[164116b2d959a392.jpeg]]

### 1.3 é€‰æ‹©æ­£ç¡®çš„å®šåˆ¶è¦ç‚¹

#### 1.3.1 `TextKit` çš„æ¶æ„ç»„æˆ

åƒ `Cocoa` ä¸‹çš„è®¸å¤šç»„ä»¶ä¸€æ ·ï¼Œ `TextKit` ä¹Ÿæ˜¯åŸºäº â€œmodel - view - controllerâ€ è®¾è®¡ç»“æ„çš„ã€‚å¹¶ä¸”è¿™ä¸‰å±‚åˆå„è‡ªåŒ…å« storageã€layoutã€å’Œ display æ¨¡å—ï¼š

![[164116c0c3fe8403 1.jpeg]]

* **`Storage`**
æ·±å…¥äº†è§£ä¸€ä¸‹å„ä¸ªéƒ¨åˆ†çš„ç»„æˆï¼Œé¦–å…ˆæ˜¯ä¸ `Model` å±‚é€šä¿¡çš„ `Storage` æ¨¡å—ï¼Œå®ƒåŒ…å«çš„ `NSTextStorage` æŒæœ‰å­—ç¬¦ä¸²çš„æ•°æ®å’Œå±æ€§ä¿¡æ¯ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå®ƒæ˜¯ `MutableAttributedString` çš„å­ç±»ï¼Œå› æ­¤ä½¿ç”¨æ–¹å¼å’Œæˆ‘ä»¬ç†ŸçŸ¥çš„ `AttributedString` ä¸€è‡´ã€‚è€Œ `NSTextContainer` åˆ™è´Ÿè´£æ¨¡å‹åŒ–æ–‡æœ¬å¸ƒå±€çš„åœ°ç†ä½ç½®ã€åŒºåŸŸä¿¡æ¯ã€‚


![[164116cff04c40bc 1.jpeg]]

* **`Display`**
æ¥ä¸‹æ¥æ˜¯ `Display` æ¨¡å—ï¼Œå®ƒå’Œ `View` å±‚é€šä¿¡ã€‚è¿™ä¸ªæ¨¡å—æˆ‘ä»¬é€šå¸¸å…³æ³¨çš„æ˜¯æ–‡æœ¬æ§ä»¶çš„æ­£ç¡®é€‰æ‹©é—®é¢˜ã€‚

* **`Layout`**
æœ€åæ˜¯ `Layout` æ¨¡å—ï¼Œå®ƒå’Œ `Controller` å±‚è¿›è¡Œé€šä¿¡ã€‚ `NSLayoutManager` æ˜¯è¿™ä¸ªæ¨¡å—å”¯ä¸€çš„ç»„æˆéƒ¨åˆ†ã€‚å®ƒçš„å¼ºå¤§è®©è‹¹æœç”¨â€œé‡å…½â€æ¥å½¢å®¹ã€‚ **å®ƒæ˜¯æ•´ä¸ªå±•ç¤ºè¿‡ç¨‹çš„â€œå¤§è„‘â€ï¼Œæ§åˆ¶è‡ªå·±çš„å¸ƒå±€è¿‡ç¨‹ã€‚**

![[164116dfb4175b49 1.jpeg]]

#### 1.3.2 å¸ƒå±€è¿‡ç¨‹

è¿™æ˜¯æ–‡æœ¬å¸ƒå±€è¿‡ç¨‹çš„æ¦‚è§ˆå›¾ï¼š

![[164116e59a1e57b9.jpeg]]

* **å±æ€§ä¿®æ­£**
æ–‡æœ¬å¸ƒå±€å‘ç”Ÿåœ¨ `TextStorage` è¿›è¡Œå±æ€§ä¿®æ­£ä¹‹åã€‚å¯¹äºè¿™ä¸ªè¿‡ç¨‹ä¸­çš„å·¥ä½œï¼Œä¸¾ä¸ªä¾‹å­ï¼Œç¡®ä¿è¿™æ®µæ–‡æœ¬æ‰€é€‰æ‹©çš„å­—ä½“æ”¯æŒæ˜¾ç¤ºæ–‡æœ¬ä¸­çš„æ‰€æœ‰å­—ç¬¦ï¼Œå¦‚æœå‘ç°ä¸æ”¯æŒçš„å­—ç¬¦ï¼Œåˆ™è¿›è¡Œç›¸åº”æ›¿æ¢ã€‚æ¯”å¦‚ä¸Šå›¾ä¸­çš„ `Tempura (å¤©éº©ç¾…) is a tasty Japanese food. ğŸ¤` è¿™æ®µæ–‡æœ¬ï¼Œå­—ä½“æŒ‡å®šäº† `Times New Roman` ã€‚ç„¶è€Œï¼Œè¿™ä¸ªå­—ä½“æ˜¯ä¸æ”¯æŒæ—¥è¯­å­—ç¬¦å’Œ emoji å­—ç¬¦çš„ã€‚å› æ­¤ï¼Œåœ¨å±æ€§ä¿®æ­£è¿‡ç¨‹ä¸­ï¼Œæ—¥è¯­å­—ç¬¦è¢«æŒ‡å®šäº†æ”¯æŒæ—¥è¯­çš„ `Hiragino Mincho ProN` å­—ä½“ï¼Œè€Œ emoji å­—ç¬¦åˆ™è¢«æŒ‡å®šäº† `Apple Color Emoji` å­—ä½“ã€‚

* **`glyph` å’Œ `character`**
å±æ€§ä¿®æ­£å®Œæˆåï¼Œå¸ƒå±€è¿‡ç¨‹å°±å¼€å§‹äº†ã€‚è¿™é‡Œå¯¹ä¸Šè¿°æ¦‚å¿µçš„å«ä¹‰åšä¸€äº›è¯´æ˜ã€‚

`character` ä¸­æ–‡è¯‘ä¸ºâ€œå­—ç¬¦â€ï¼Œå­—ç¬¦æ˜¯å¯ä»¥è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­˜å‚¨çš„é€šç”¨æ•°æ®ï¼Œè€Œ `glyph` å¯ä»¥è¯‘ä¸ºå­—ç¬¦çš„è§†è§‰è¡¨ç¤ºç¬¦å·ã€‚åŒä¸€ä¸ª `character` å‘ˆç°åœ¨å±å¹•ä¸Šï¼Œå¯ä»¥è¡¨ç°ä¸ºä¸åŒçš„å­—ä½“ã€è§†è§‰é£æ ¼ã€‚è€Œè¿™äº›å„å¼‚çš„è§†è§‰é£æ ¼ï¼Œå°±æ˜¯ç”± `glyph` æ¥è´Ÿè´£å‘ˆç°ï¼Œ `glyph` çš„ç”Ÿæˆï¼Œå°±æ˜¯ä¸ºæŒ‡å®šäº†è§†è§‰æ•ˆæœï¼ˆå¦‚å­—ä½“ï¼‰çš„å­—ç¬¦ç¡®å®šå±•ç¤ºæ‰€éœ€çš„ `glyph` çš„è¿‡ç¨‹ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

![[164117131de029a3.jpeg]]

å¯ä»¥çœ‹åˆ°ï¼Œ `character` å’Œ `glyph` çš„å¯¹åº”å…³ç³»ä¸æ€»æ˜¯ä¸€å¯¹ä¸€çš„ã€‚å›¾ä¸­çš„å­—ç¬¦ä¸² â€œffiâ€ ç”±ä¸‰ä¸ªå­—ç¬¦ç»„æˆï¼Œä½†æ•´ä¸ªå­—ç¬¦ä¸²å¯ä»¥ç”±ä¸€ä¸ª `glyph` è¡¨ç¤ºã€‚å†çœ‹ä¸‹å›¾çš„ä¾‹å­ï¼Œä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ â€œnâ€ï¼Œä¹Ÿå¯ä»¥ç”±ä¸¤ä¸ª `glyph` æ¥è¡¨ç¤ºã€‚

![[1641171e785f7a4c.jpeg]]

> å…³äºè¿™éƒ¨åˆ†æ¦‚å¿µï¼Œæä¾›ä¸€ç¯‡å‚è€ƒèµ„æ–™ï¼š [iOS æ’ç‰ˆæ¦‚å¿µ](https://www.jianshu.com/p/8853174f574b)

å†å›åˆ°å¸ƒå±€è¿‡ç¨‹çš„å›¾ç¤ºä¸­æ¥ï¼Œ `glyph` å¸ƒå±€ï¼Œå°±æ˜¯ `NSLayoutManager` åœ¨è§†å›¾ä¸Šæ‘†æ”¾ `glyph` çš„è¿‡ç¨‹ã€‚

### 1.4 é€‰æ‹©æ­£ç¡®çš„é…ç½®

å¦‚ä¸‹å›¾æ˜¯ ä¸€ä¸ªå®Œæ•´ `TextKit` ç»„ä»¶çš„æ ‡å‡†é…ç½®ç»“æ„ï¼š `Text Container` æŒæœ‰ `Text View` çš„å¼±å¼•ç”¨ï¼Œè€Œ `Text View` é€šè¿‡æ ¹ `Text Storage` æŒæœ‰æ•´ä¸ªå¸ƒå±€æ ‘ç»“æ„ã€‚

![[1641172648ebeb98 1.jpeg]]

å¦‚æœæœ‰å¤šä¸ªæ–‡æœ¬é¡µé¢æˆ–è€…æ–‡æœ¬è¡Œéœ€è¦å¸ƒå±€ï¼Œå¯ä»¥ä½¿ç”¨æˆå¯¹çš„ `Text Container` å’Œ `Text View` ç»„åˆï¼Œæ¯ä¸€å¯¹ç»„åˆå¯¹åº”ä¸€ä¸ªé¡µé¢æˆ–è€…ä¸€è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ hook åŒæ ·çš„ container å’Œ text view æ¥å…±äº«å¸ƒå±€ä¿¡æ¯ã€‚

![[1641172b8181af0a 1.jpeg]]

æ–‡æœ¬å†…å®¹è¢«æ·»åŠ ä¹‹åï¼Œå®ƒé“ºæ»¡ç”±ç¬¬ä¸€ä¸ª text container å®šä¹‰çš„åŒºåŸŸã€‚æ–‡æœ¬åœ¨ text view ä¸Šå’Œ text container æˆå¯¹å±•ç¤ºã€‚ å½“æ²¡æœ‰å‰©ä½™ç©ºé—´æ—¶ï¼Œæ–°çš„ container è¿åŒ text view ä¸€èµ·è¢«æ·»åŠ ï¼Œå¹¶ä¸”æ–‡æœ¬åœ¨ç¬¬äºŒä¸ªé¡µé¢æˆ–è€…æ–‡æœ¬è¡Œè¿›è¡Œå±•ç¤ºã€‚

å¤šä¸ª layout manager å…è®¸ä½ å¯¹åŒæ ·çš„æ–‡æœ¬æœ‰å¤šç§ä¸åŒçš„æ˜¾ç¤ºæ•ˆæœã€‚è¿™ä¸ªæ–‡æœ¬åœ¨ä¸åŒçš„è§†å›¾ä¸Šå¯ä»¥æœ‰å½¼æ­¤ä¸åŒä¸”ç‹¬ç«‹çš„å¸ƒå±€å’Œåˆ†ç»„ï¼Œä¸‹å›¾æ˜¯è¿™ç§æ¨¡å¼ä¸‹çš„ç»“æ„ç¤ºæ„å’Œæ•ˆæœç¤ºæ„ã€‚æ–¹æ¡†å†…çš„æ–‡æœ¬å†…å®¹ç›¸åŒï¼Œä½†å±•ç¤ºæ•ˆæœæ˜¯ä¸åŒçš„ã€‚

![[1641173bb442bccc 1.jpeg]]

### 1.5 é€‰æ‹©æ­£ç¡®çš„å®šåˆ¶å®ç°æ–¹å¼

å°±åƒé”¤å­åœ¨å·¥å…·ç®±ä¸­çš„é‡è¦åœ°ä½ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨å¼€å‘æ—¶ä¹Ÿæœ‰ä¸€äº›åœ°ä½ç­‰åŒäºé”¤å­çš„å·¥å…·ã€‚

* `ä»£ç†` å°±åƒåŸºæœ¬çš„é”¤å­ï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°å®Œæˆå·¥ä½œã€‚
* `é€šçŸ¥` ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å·¥å…·ã€‚
* æœ€åï¼Œ `å­ç±»åŒ–` åŒæ ·æ˜¯ä¸€æŠŠåˆ©å™¨ã€‚å®ƒå‡ ä¹å¯ä»¥ä½œä»»ä½•äº‹ã€‚
å¯¹äºè¿™äº›æ–¹å¼çš„ä½¿ç”¨åœºæ™¯ï¼Œåœ¨ç¬¬äºŒéƒ¨åˆ†ä¼šè¿ç”¨å…·ä½“ä¾‹å­è¿›è¡Œé˜è¿°ã€‚

## äºŒã€å…·ä½“ç¤ºä¾‹

æ–‡æœ¬ç»„ä»¶åœ¨ app ä¸­æ˜¯æ— å¤„ä¸åœ¨çš„ã€‚åœ¨è¿™éƒ¨åˆ†ï¼Œè‹¹æœä½¿ç”¨äº† iOS çš„ `Apple News` å’Œ Mac OS çš„ `TextEdit` ã€`Our Journal` ä¸‰ä¸ª app ä¸­çš„å…·ä½“é¡µé¢ä½œä¸ºç¤ºä¾‹æ¥å¯¹å‰é¢æ‰€è¿°çš„æ ¸å¿ƒç†è®ºè¿›è¡Œè®²è§£ã€‚

### 2.1 Apple News on iOS

è¿™éƒ¨åˆ†å†…å®¹æ¯”è¾ƒç®€å•ã€‚ä¸»è¦ç”¨æ¥ç¤ºæ„ `Choosing the right control` è¿™æ¡ç†è®ºã€‚é‡Œé¢ä¸»è¦çš„çŸ¥è¯†ç‚¹å¦‚ä¸‹ï¼š

* å¯¹äºä¸€è¡Œé¢œè‰²ä¸ä¸€æ ·çš„æ–‡æœ¬ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ª `UILabel` è¿›è¡Œå±•ç¤ºï¼Œä¹Ÿå¯ä»¥å€ŸåŠ© `NSAttributedString` æ¥å®ç°ã€‚
* `UITextView` æ˜¯ `UIScrollView` çš„å­ç±»ï¼Œé»˜è®¤æ”¯æŒæ»‘åŠ¨ï¼Œå¦‚æœæƒ³è®©å®ƒä¸è‡ªåŠ¨å¸ƒå±€è‰¯å¥½åä½œåœ°è¯ï¼Œéœ€è¦ç¦ç”¨æ»‘åŠ¨ã€‚
### 2.2 TextEdit on macOS

è¿™éƒ¨åˆ†ä¸»è¦ç”¨æ¥ç¤ºæ„ `Choosing the right configuration` è¿™æ¡ç†è®ºã€‚

![[1641175fe77846b0.jpeg]]

`TextEdit` è¿™ä¸ª app æ”¯æŒå¯Œæ–‡æœ¬çš„å±•ç¤ºã€ç¼–è¾‘ï¼Œæ–‡æœ¬ç¼–è¾‘éƒ¨åˆ†çš„ç‰¹æ€§å¾ˆåƒä¸€ä¸ª textviewï¼Œè‡ªç„¶ï¼Œå®ƒç¬¦åˆå‰é¢è®²è¿°çš„æ ‡å‡†é…ç½®ç»“æ„ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ–‡æœ¬ç¼–è¾‘éƒ¨åˆ†æ”¯æŒåˆ†é¡µå±•ç¤ºï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢ä¸‹æ»‘æ—¶ï¼Œtextcontainer è¢«é‡æ–°è®¾ç½®äº†å°ºå¯¸ï¼Œæ–‡æœ¬ä»ç¬¬ä¸€é¡µè·³åˆ°äº†ç¬¬äºŒé¡µã€‚å¾ˆè‡ªç„¶ï¼Œè¿™æ˜¯ä½¿ç”¨äº†å¤šä¸ª textcontainer çš„ textviewï¼Œä½†æ˜¯ä¾ç„¶ç”±åŒä¸€ä¸ª textstorgeã€layoutmanager ç®¡ç†ï¼Œä»–ä»¬å…è®¸æ–‡æœ¬è‡ªç”±åœ°ä»ä¸€ä¸ª textcontainer è·³åˆ°å¦ä¸€ä¸ªã€‚ä¸‹å›¾å³æ˜¯å®ƒçš„é…ç½®ç»“æ„å›¾ï¼š

![[1641177235355318.jpeg]]

### 2.3 Our Journal App on macOS

è¿™éƒ¨åˆ†ä¸»è¦ç”¨æ¥ç¤ºæ„ `Choosing the right customization approach` è¿™æ¡ç†è®ºã€‚

![[1641177e18be8231.jpeg]]

#### 2.3.1 æ–‡æœ¬è®¡æ•°åŠŸèƒ½

ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç•Œé¢åº•éƒ¨æ·»åŠ äº†ä¸€ä¸ª TextField æ¥æ˜¾ç¤ºé”®å…¥æ–‡æœ¬çš„æ•°é‡ã€‚app è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åº•éƒ¨çš„æ–‡æœ¬è®¡æ•°éšç€é”®å…¥çš„æ•°é‡å˜åŒ–ã€‚ä¸ºäº†å®ç°è¿™ä¸ªæ•ˆæœï¼Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæ¯”è¾ƒâ€œè½»å·§â€çš„å·¥å…· - é€šçŸ¥ã€‚é€šè¿‡æ¥æ”¶ NSTextStorage å‘å‡ºçš„é€šçŸ¥ï¼Œå¯ä»¥ä» NSTextStorage è·å¾—æ–‡æœ¬çš„æ•°é‡ã€‚æ”¶åˆ°é€šçŸ¥åï¼Œæ›´æ–°è®¡æ•° TextField ä¸­çš„æ•°å­—ã€‚

#### 2.3.2 è‡ªåŠ¨è½¬åŒ–ç²—ä½“å­—

å½“æˆ‘ä»¬æƒ³å¼ºè°ƒä¸€éƒ¨åˆ†æ–‡å­—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é”®ç›˜å¿«æ·é”®æˆ–è€…èœå•è®¾ç½®è¿™éƒ¨åˆ†å­—ä½“ä¸ºç²—ä½“ã€‚ä½†æ˜¯å¦‚æœæƒ³æ”¯æŒä¾‹å¦‚ `markdown` çš„æ ‡è®°è¯­è¨€ï¼Œé€šè¿‡ç‰¹å®šå­—ç¬¦æ¥æŒ‡å®šç‰¹æ®Šçš„æ ¼å¼ï¼Œæ¯”å¦‚åœ¨æ–‡æœ¬å‰ååŠ å…¥ä¸€å¯¹åŒæ˜Ÿå·æ¥ä½¿æ–‡æœ¬å˜åŒ–ä¸ºç²—ä½“ï¼Œè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿåœ¨è¿™ä¸ªæƒ…æ™¯ä¸­ï¼Œéœ€è¦è·å–æ–‡æœ¬æ”¹å˜çš„æ—¶æœºå’Œä½ç½®ï¼Œé€šçŸ¥æœºåˆ¶å¹¶ä¸ä¾¿äºæä¾›è¶³å¤Ÿçš„ä¿¡æ¯ã€‚æ‰€ä»¥è¿™æ¬¡ä½¿ç”¨â€œä¸€è®°é‡é”¤â€ - ä»£ç†ã€‚éµå®ˆ `NSTextStorageDelegate` åè®®ï¼Œå®ç° `textStorage(_:didProcessEditing:range:changeInLength:)` æ–¹æ³•ã€‚åœ¨æ–¹æ³•çš„å®ç°ä¸­å®šä¹‰ä¸€ä¸ªç²—ä½“å­—çš„ attribute ï¼Œæ·»åŠ ç»™åº”è¯¥è¢«ç²—ä½“åŒ–çš„æ–‡æœ¬ã€‚è¿™æ ·ä¸€æ¥ï¼Œåªè¦è¾“å…¥äº†ä¸€å¯¹åŒæ˜Ÿå·ï¼Œå°±å¯ä»¥ç«‹é©¬ä½¿æ–‡æœ¬å˜ä¸ºç²—ä½“ã€‚

![[1641178da14ffb25.jpeg]]

#### 2.3.3 ä»£ç ç‰‡æ®µæ–‡æœ¬

ç²—ä½“æ ‡è®°å®Œç¾å®ç°äº†ã€‚é‚£ä¹ˆå¦‚ä½•å±•ç¤ºä¸€ä¸ªä»£ç ç‰‡æ®µå‘¢ï¼Ÿåƒå›¾ä¸­æ‰€ç¤ºï¼Œå®Œæˆé”®å…¥æœ€åä¸€ä¸ªç‚¹ç¬¦å·ï¼Œå°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªä»£ç å—æ–‡æœ¬ï¼ŒåŒæ—¶è¿˜ä¼šè¢«æ ‡ç¤ºä¸º `Swift` ä»£ç ã€‚å¯¹äºè¿™æ ·ä¸€ä¸ªå¤æ‚çš„æƒ…å½¢ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤æŠŠå·¥å…·ï¼š

* å­ç±»åŒ– `NSTextStorage`
å­ç±»ç»§æ‰¿ `NSTextStorage` ï¼Œå®ç°å››ä¸ªå¼ºåˆ¶å®ç°çš„æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯ `replaceCharacters(in:with:)` æ–¹æ³•ã€‚å†…éƒ¨å®ç°æ˜¯å°† `NSTextBlock` èµ‹å€¼ç»™ `ParagraphStyle` ç„¶åæŠŠè¿™ä¸ª `ParagraphStyle` ä½œä¸ºä¸€ä¸ª `attribute` æ·»åŠ åˆ°ä¸€ä¸ª `NSTextStorage` ä¸­ï¼Œæ³¨æ„å¯¹åº”çš„èŒƒå›´æ˜¯ä»£ç å—æ–‡æœ¬ã€‚

![[16411795bdcc60f6.jpeg]]

å¯¹äºä¸Šé¢æ‰€è¿°çš„ `NSTextBlock` ï¼Œéœ€è¦äº†è§£çš„æ˜¯ `NSTextBlock` ä¸ä¼šå»å®šåˆ¶åŒ–ç»˜åˆ¶å®ƒè‡ªå·±ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®ƒçš„å­ç±»å»å®Œæˆè¿™ä»¶äº‹ï¼š `CodeBlock` ç±»ç»§æ‰¿è‡ª `NSTextBlock` ï¼Œåœ¨å®ƒçš„åˆå§‹åŒ–æ–¹æ³•ä¸­è®¾ç½®èƒŒæ™¯çš„è¡¬å«ï¼Œæˆ–è€…é€šè¿‡è¦†å†™ `drawBackground` æ–¹æ³•ï¼Œä½¿ç”¨ StringDrawing å»ç»˜åˆ¶ â€œSwift Codeâ€ è¿™ä¸ªæ ‡é¢˜ã€‚

![[1641179bc9812b3c.jpeg]]

è¿™æ ·ä¸€æ¥è¿™ä¸ªæ–‡æœ¬å—çœ‹èµ·æ¥å°±åƒä¸€ä¸ªä»£ç å—äº†ã€‚å†å›åˆ°ç»§æ‰¿è‡ª `TextStorage` çš„ `CustomTextStorage` ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ `TextBlocks` å±æ€§èµ‹å€¼ä¸ºåˆšåˆšæ·»åŠ çš„ `CodeBlock` ã€‚

![[164117a027949530.jpeg]]

æœ€åï¼Œæˆ‘ä»¬éœ€è¦è®© textview ä½¿ç”¨å…¨æ–°çš„ `CustomTextStorage` ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸º `LayoutManager` æ›¿æ¢ storageã€‚

![[164117a39ace04cf.jpeg]]

#### 2.3.4 markdownæ•ˆæœé¢„è§ˆè§†å›¾

è¿™æ ·ä¸€æ¥ï¼ŒåŸºæœ¬å®Œæˆäº†ä¸€ä¸ªæ”¯æŒ markdown æ ¼å¼çš„ç¼–è¾‘å™¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸€èˆ¬ markdown ç¼–è¾‘å™¨è¿˜æœ‰ä¸€ä¸ªå¾ˆå®ç”¨çš„åŠŸèƒ½ - ä¸¤ä¸ªå¹¶æ’å¸ƒå±€çš„è§†å›¾ï¼Œä¸€ä¸ªç”¨æ¥è¾“å…¥æ–‡æœ¬ï¼Œä¸€ä¸ªé¢„è§ˆæ•ˆæœï¼Œå¦‚å›¾æ‰€ç¤ºï¼š

![[164117aaeb3b2167.jpeg]]

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå¹¶æ’çš„ textview æ¥å®ç°ï¼Œåªéœ€è¦ç¦ç”¨ç”¨äºé¢„è§ˆçš„ textview çš„æ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ã€‚å®ƒä»¬å±•ç¤ºä¸€æ ·çš„å†…å®¹ï¼Œä½†æ˜¯å³è¾¹çš„æ ·å¼ä¼šç‰¹åˆ«ä¸€äº›ã€‚ä½¿ç”¨çš„é…ç½®å¦‚å›¾ï¼š

![[164117ae88ed22fd.jpeg]]

storage æ˜¯åŒä¸€ä¸ªï¼Œå› ä¸ºå±•ç¤ºä¸€æ ·çš„å†…å®¹ã€‚ä½†æ˜¯å…¶ä»–çš„éƒ¨åˆ†éƒ½æ˜¯ä¸¤å¥—ï¼Œå¹¶ä¸”ç”¨å·¦è¾¹ view çš„ textstorage ä¸ºå³è¾¹ view çš„ layoutmanager çš„ `replaceTextStorage` èµ‹å€¼ã€‚è¿™æ ·çš„æ•ˆæœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸€æ—¦åœ¨ä¸€è¾¹ç¼–è¾‘äº†æ–‡æœ¬ï¼Œæ•ˆæœä¼šåœ¨ä¸¤è¾¹åŒæ—¶å±•ç¤ºã€‚ä½†æ˜¯ä¸€èˆ¬åœ¨é¢„è§ˆè§†å›¾å†…æˆ‘ä»¬æ˜¯ä¸å¸Œæœ›æ˜¾ç¤º markdown æ ¼å¼æ§åˆ¶ç›¸å…³å­—ç¬¦çš„ï¼Œæ¯”å¦‚åŒæ˜Ÿå· `**` å’Œ å¼•ç”¨ç¬¦å· `>` ç­‰ã€‚ç”±äºæ˜¯å…±äº«çš„åŒä¸€ä¸ª textstorgeï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬å¿…é¡»åœ¨åé¢çš„è¿‡ç¨‹ä¸­ï¼ˆå¸ƒå±€è¿‡ç¨‹ï¼‰éšè—è¿™äº›å­—ç¬¦ã€‚ä¸ºäº†å®Œæˆè¿™ä¸ªæ“ä½œï¼Œå°±æœ‰äº†ä¸€ä¸ªè‡ªç„¶è€Œç„¶çš„é€‰é¡¹--ä»£ç†ï¼šéµå®ˆ `NSLayoutManagerDelegate` ä»£ç†åè®®ï¼Œå®ç° `layoutManager(_:shouldGenerateGlyphs:properties: characterIndexes:font:forGlyphRange:)` ä»£ç†æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°å°†è¦è¢«å¸ƒå±€çš„ glyphsï¼Œå¦‚æœå®ƒæ˜¯ç”¨æ¥è¡¨ç¤º markdown å­—ç¬¦çš„ glyphï¼ŒæŠŠå®ƒèµ‹å€¼ä¸ºç©ºã€‚æœ€åï¼ŒæŠŠå¤„ç†è¿‡çš„ glyphs å›ä¼ ã€‚è¿™æ ·ä¸€æ¥ï¼Œå·¦è¾¹å±•ç¤ºå¯ç¼–è¾‘çš„åŒ…å« markdown æ§åˆ¶å­—ç¬¦çš„æ–‡æœ¬ï¼Œå³è¾¹å±•ç¤ºå»é™¤äº† markdown æ§åˆ¶å­—ç¬¦çš„æ•ˆæœæ–‡æœ¬ã€‚è™½ç„¶äº‹å®ä¸Šä¸€ä¸ª markdown ç¼–è¾‘å™¨å¹¶ä¸æ˜¯è¿™æ ·å¤„ç†ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå®šåˆ¶ `TextKit` çš„å¾ˆå¥½çš„ä¾‹å­ã€‚

## ä¸‰ã€æœ€ä½³å®æˆ˜æ¡ˆä¾‹

åœ¨è¿™éƒ¨åˆ†ä¸­ï¼Œè‹¹æœç»™å‡ºäº†å‡ ä¸ªæŒ‡å¯¼æ€§åŸåˆ™ã€‚

### 3.1 ç†ŸçŸ¥é»˜è®¤ attribute

![[164117baaf3d4c9a.jpeg]]


åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆä¸€ä¸ªå¦‚ä¸Šå›¾çš„æ–‡æœ¬å±•ç¤ºã€‚å®ƒå½“å‰çš„å­—ä½“æ˜¯ 24 å·çš„ `Comic Sans MS` ã€‚ç»™ `don't` è¿™éƒ¨åˆ†æ–‡æœ¬è®¾ç½®ç²—ä½“çš„ attribute ä¹‹åï¼Œæˆ‘ä»¬å‘ç°å‰©ä½™çš„æ–‡æœ¬ï¼ˆå³ `hate` ï¼‰ä¸¢å¤±äº†åŸæœ¬çš„å­—ä½“è®¾ç½®ã€‚è¿™æ˜¯å› ä¸ºåˆå§‹åŒ– `AttributedString` æ—¶ï¼Œæ²¡æœ‰æä¾› attribute è®¾ç½®å‚æ•°ï¼Œé‚£ä¹ˆç³»ç»Ÿä¾¿ä¼šä½¿ç”¨é»˜è®¤çš„è®¾ç½®ã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®åˆå§‹åŒ–äº†æ–‡æœ¬ï¼Œç„¶åå¯¹ `don't` éƒ¨åˆ†è¿›è¡Œäº†å•ç‹¬è®¾ç½®ï¼Œè‡ªç„¶ `hate` éƒ¨åˆ†å°±ä½¿ç”¨äº†é»˜è®¤çš„è®¾ç½®ã€‚

![[164117c1d2022bcc.jpeg]]

æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼æ¥è§£å†³è¿™ä»¶äº‹ã€‚ä¸€ç§æ˜¯é¿å…å°†æ•´ä¸ªæ–‡æœ¬åŒæ—¶è¿›è¡Œè®¾ç½®ï¼Œè€Œæ˜¯å¯¹äº `donâ€˜t` è®¾ç½®ç²—ä½“ï¼Œå¯¹äº `hate` è®¾ç½® `Comic Sans MS` ï¼Œä½†è¿™æ ·æ¯”è¾ƒç¹çã€‚æ‰€ä»¥å¦ä¸€ç§æ˜¯åˆå§‹åŒ– AttributedString æ—¶ï¼Œé™„å¸¦åŸæœ‰å­—ä½“çš„å‚æ•°ï¼Œç„¶åå¯¹ `donâ€˜t` éƒ¨åˆ†å†è¡Œè®¾ç½®ã€‚

![[164117c552f4a6b0.jpeg]]

é™¤äº†å­—ä½“å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£å…¶ä»–å±æ€§çš„é»˜è®¤å€¼ã€‚

![[164117c952ba392c.jpeg]]

### 3.2 ä½¿ç”¨å‡†ç¡®çš„å±æ€§æè¿°

* é¿å…å°†å…¨éƒ¨æˆ–éƒ¨åˆ†æ–‡æœ¬é‡ç½®ä¸ºé»˜è®¤å±æ€§çš„æ“ä½œã€‚
* åœ¨æ›´æ–°ä½ çš„ app ä»¥æ”¯æŒå³å°†åˆ°æ¥çš„é»‘æš—æ¨¡å¼æ—¶ï¼Œç¡®ä¿åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ä½ çš„æ–‡æœ¬é¢œè‰²æ­£ç¡®ã€‚å¯¹äº appkit å¼€å‘è€…ï¼Œè¿™æ˜¯éå¸¸é‡è¦çš„ã€‚
è¿™é‡Œç‰¹åˆ«æ³¨æ„ä¸Šå›¾æ ‡è®°å‡ºçš„ `ParagraphStyle` å±æ€§ã€‚ä¸€ä¸ªåé¢æ¡ˆä¾‹æ˜¯ï¼š ä¸ºäº†æˆªæ‰ `hate` éƒ¨åˆ†çš„æ–‡æœ¬ï¼Œç»™è¿™éƒ¨åˆ†æ–‡æœ¬å•ç‹¬è®¾ç½®äº† `ParagraphStyle` çš„å±æ€§ã€‚ç„¶è€Œå±•ç¤ºçš„ç»“æœå´ä¸ç¬¦åˆé¢„æœŸã€‚è¿™æ˜¯å› ä¸ºåœ¨ layout ä¹‹å‰ï¼Œä¼šè¿›è¡Œ attribute fixingï¼Œè¿™åœ¨å‰æ–‡æœ‰è¿°ã€‚ä¸€ä¸ªæ–‡æœ¬æ®µè½ï¼Œå´æœ‰å¤šä¸ª `ParagraphStyle` çš„å±æ€§å€¼ï¼Œè¿™æ˜¯è¿åä¸€è‡´æ€§çš„ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨ fix attribute æ—¶ï¼Œä¼šé€‰æ‹©ç¬¬ä¸€ä¸ª ParagraphStyle å±æ€§ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤é£æ ¼ï¼Œå¹¶ä¸”æŠŠå®ƒåº”ç”¨äºæ•´ä¸ªæ®µè½ã€‚

### 3.3 æ€§èƒ½è¡¨ç°ï¼šä½¿ç”¨é—´æ–­çš„å¸ƒå±€

ä¸ºäº†ç†è§£å®ƒï¼Œå›åˆ°æˆ‘ä»¬çš„è€æœ‹å‹ - å¸ƒå±€è¿‡ç¨‹ã€‚glyph ç”Ÿæˆä¹‹åè¿›è¡Œ glyph å¸ƒå±€ã€‚å¯¹äºå¤§æ®µæ–‡æœ¬ï¼Œå¦‚æœä½¿ç”¨æ•´ä½“çš„å¸ƒå±€ï¼Œé‚£ä¹ˆ LayoutManager å¿…é¡»å®Œæˆæ‰€æœ‰çš„ glyph ç”Ÿæˆã€å¸ƒå±€è¿‡ç¨‹ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¦‚æœæœ‰å¤§æ®µæ–‡æœ¬çš„è¯ä½ å°±éœ€è¦é•¿æ—¶é—´åœ°ç­‰å¾…ã€‚

![[164117cd1d618e4d.jpeg]]

å¯¹äº `NSTextView` ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½® `allowsNonContiguousLayout` å±æ€§æ¥æ”¯æŒé—´æ–­å¸ƒå±€ã€‚

å¯¹äº `UITextView` ï¼Œå®ƒæ˜¯é»˜è®¤å¼€å¯çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ `UITextView` æ˜¯ `UIScrollView` çš„å­ç±»ï¼Œ `allowsNonContiguousLayout` å±æ€§è¦æ±‚ `UITextView` çš„ `Scroll Enabled` å±æ€§æ˜¯å¼€å¯çš„ã€‚å› ä¸ºå¦‚æœä¸æ”¯æŒæ»‘åŠ¨çš„è¯ï¼Œé—´æ–­å¸ƒå±€ä¹Ÿå°±å¤±å»äº†æ„ä¹‰ã€‚

è¿™å°±å¼•å‡ºäº†ä¸€ä¸ªé‡è¦çš„é—®é¢˜ã€‚ä½¿ç”¨é—´æ–­å¸ƒå±€æ—¶ï¼Œé¿å…ä¸€æ¬¡è¯·æ±‚æ•´ä¸ªæ–‡æœ¬çš„å¸ƒå±€ã€‚æ‰€ä»¥å¦‚æœä½ åªæœ‰ä¸€ä¸ª textcontainer çš„è¯ï¼Œé¿å…ä¸€æ¬¡è¯·æ±‚å®Œæ•´çš„å¸ƒå±€ã€‚

### 3.4 å®‰å…¨æ€§

è¿™é‡Œè‹¹æœç»™å‡ºäº†ä¸€ä¸ªå½¢è±¡çš„ä¾‹å­ï¼šå¼€å‘è€…å°±åƒæ­¦è£…çš„å£«å…µï¼Œè€Œ iOSã€Mac OS å°±åƒåšå›ºçš„å ¡å’ï¼Œå£«å…µå’Œå ¡å’å…±åŒç»„æˆäº†åšå›ºçš„å®‰å…¨æ€§é˜²å¾¡å·¥äº‹ã€‚è¿™å°±æ„å‘³ç€ï¼ŒiOS åº”ç”¨çš„å®‰å…¨æ€§éœ€è¦å¼€å‘è€…å’Œè‹¹æœå…±åŒåä½œã€‚

![[164117d204a7b20b.jpeg]]

ä¸ºæ­¤ï¼Œè‹¹æœä¸ºå¼€å‘è€…æä¾›äº†ä¸€æ¡å‡†åˆ™ï¼š

* ä¸ºæ–‡æœ¬è¾“å…¥è®¾ç½®é™åˆ¶
æ‰€æœ‰çš„æ–‡æœ¬è¾“å…¥éƒ½è¢«è®¤ä¸ºæ˜¯æ½œåœ¨çš„é£é™©ã€‚å½“ä½ å…è®¸æ–‡æœ¬è¾“å…¥æ—¶ï¼Œä½ å°±å¼€æ”¾äº†å¤åˆ¶å’Œç²˜è´´ï¼Œä½†æ˜¯ä½ å¹¶ä¸èƒ½é¢„çŸ¥ä»€ä¹ˆæ–‡æœ¬ä¼šè¢«ç²˜è´´åœ¨é‚£é‡Œã€‚å®ƒå¯èƒ½æ˜¯ä¸€æ®µæ™®é€šçš„æ–‡æœ¬ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½æ˜¯æå…¶é•¿çš„æ–‡æœ¬ï¼Œè€Œè¿™å°†ä¼šå¯¼è‡´ä½ çš„ app å‡ºç°ä¸å¯é¢„çŸ¥çš„é—®é¢˜ã€‚

å¦‚ä½•å®Œæˆå¯¹æ–‡æœ¬çš„è¾“å…¥è¿›è¡ŒéªŒè¯å‘¢ï¼Ÿåœ¨ `UIKit` ä¸‹ï¼Œä½¿ç”¨ `UITextFieldDelegate` ï¼Œåœ¨ `AppKit` ä¸‹é€šè¿‡ `NSFormatter` ã€‚

**å€¼å¾—æœŸå¾…çš„æ˜¯ï¼Œè‹¹æœé¢„å‘Šäº†å…³äºå®‰å…¨æ€§æå‡çš„å†…å®¹å³å°†åˆ°æ¥** ã€‚

## æ€»ç»“

æœ€åï¼Œç”¨ä¸€å¼ å›¾æ¥æ€»ç»“è¿™ä¸ª session çš„å†…å®¹ï¼š

![[164117d593a9bfeb.jpeg]]

> *æŸ¥çœ‹æ›´å¤š WWDC 18 ç›¸å…³æ–‡ç« è¯·å‰å¾€* [è€å¸æœºxçŸ¥è¯†å°é›†xSwiftGG WWDC 18 ä¸“é¢˜ç›®å½•](https://link.juejin.im?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2F6f95f7631d36)

